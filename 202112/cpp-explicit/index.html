<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>explicit说明符 - Bing's Blog</title><meta name=keywords content="[Life bbing bing hugo Blog C++ LoveIt]"><meta name=Description content="个人技术博客"><meta property="og:title" content="explicit说明符"><meta property="og:description" content="一直对explicit的认知比较模糊, 在准备智能指针内容的时候, 看到了这个内容, 所以索性认认真真学习一遍.
简单来说, explicit表达的是: 只允许显示行为, 不允许隐式行为.
要理解上面的解释, 就需要理解哪些是C++的显示行为, 哪些是隐式行为."><meta property="og:type" content="article"><meta property="og:url" content="https://imcbc.cn/202112/cpp-explicit/"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/caibingcheng/resources@main/images/13bOkrO.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-23T14:03:32+08:00"><meta property="article:modified_time" content="2021-12-23T14:03:36+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cdn.jsdelivr.net/gh/caibingcheng/resources@main/images/13bOkrO.png"><meta name=twitter:title content="explicit说明符"><meta name=twitter:description content="一直对explicit的认知比较模糊, 在准备智能指针内容的时候, 看到了这个内容, 所以索性认认真真学习一遍.
简单来说, explicit表达的是: 只允许显示行为, 不允许隐式行为.
要理解上面的解释, 就需要理解哪些是C++的显示行为, 哪些是隐式行为."><meta name=application-name content="Bing's Blog"><meta name=apple-mobile-web-app-title content="Bing's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://imcbc.cn/202112/cpp-explicit/><link rel=prev href=https://imcbc.cn/202112/talk-rssblogsource/><link rel=next href=https://imcbc.cn/202112/stl-smartpointers/><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/gh/Albejr/jquery-albe-timeline/templates/simple/style-albe-timeline.css><link rel=stylesheet href=https://fastly.jsdelivr.net/gh/caibingcheng/orlike@client/orlike.min.css><link rel=stylesheet href=/css/custom.css><meta name=google-site-verification content="xy1bCgQPV_H3_o2XD34o2mIByQxmzkV3GPOfhXg_mTM"><meta name=msvalidate.01 content="c81a65b6344571786df543a56c7bbe18"><meta name=baidu-site-verification content="code-WcyzWjgFYo"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"explicit说明符","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/imcbc.cn\/202112\/cpp-explicit\/"},"image":["https:\/\/imcbc.cn\/android-chrome-192x192.png"],"genre":"posts","keywords":"Cpp","wordcount":2699,"url":"https:\/\/imcbc.cn\/202112\/cpp-explicit\/","datePublished":"2021-12-23T14:03:32+08:00","dateModified":"2021-12-23T14:03:36+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Bing","logo":"https:\/\/imcbc.cn\/android-chrome-192x192.png"},"author":{"@type":"Person","name":"bbing"},"description":""}</script></head><body header-desktop=normal header-mobile=normal><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/caibingcheng/ class=github-corner aria-label="View source on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Bing's Blog">Bing's Blog</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title><i class='fas fa fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/tags/ title><i class='fas fa fa-tag'></i> 标签 </a><a href=/categories/ title><i class='fas fa fa-th'></i> 分类</a></div></div><a class=menu-item href=/friends/><i class='fas fa fa-users'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa fa-angle-double-down'></i> 更多</a><div class="menu-more-content dropdown-content"><a href=/tools/ title><i class='fas fa fa-cubes'></i> 工具 </a><a href=/about/ title><i class='fas fa fa-address-card'></i> 关于 </a><a href=/timeline/ title><i class='fas fa fa-building'></i> 建站 </a><a href=/index.xml/ title><i class='fas fa fa-rss'></i> RSS</a></div></div><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章内容 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.cn/bbing class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://www.foreverblog.cn/go.html class=menu-item target=_blank rel=noopener title=穿梭虫洞><i class="fas fa-fw fa-life-ring" title=穿梭虫洞-随机访问十年之约友链博客></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Bing's Blog">Bing's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章内容 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a href=/posts/ class=menu-item title><i class='fas fa fa-archive'></i> 归档</a>
<a href=/tags/ class=menu-item title><i class='fas fa fa-tag'></i> 标签</a>
<a href=/categories/ class=menu-item title><i class='fas fa fa-th'></i> 分类</a>
<a class=menu-item href=/friends/><i class='fas fa fa-users'></i> 友链</a>
<a href=/tools/ class=menu-item title><i class='fas fa fa-cubes'></i> 工具</a>
<a href=/about/ class=menu-item title><i class='fas fa fa-address-card'></i> 关于</a>
<a href=/timeline/ class=menu-item title><i class='fas fa fa-building'></i> 建站</a>
<a href=/index.xml/ class=menu-item title><i class='fas fa fa-rss'></i> RSS</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class=single-title>explicit说明符<sup>
<a id=reader-button-title title=阅读模式><i class="fa fa-book fa-fw"></i></a></sup></h1><div class=post-meta><div class=post-meta-line></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-12-23>2021-12-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2699 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#显示行为和隐式行为>显示行为和隐式行为</a></li><li><a href=#explicit-is-better-than-implicit>explicit is better than implicit</a></li></ul></nav></div></div><div class=content id=content><p>一直对<code>explicit</code>的认知比较模糊, 在准备智能指针内容的时候, 看到了这个内容, 所以索性认认真真学习一遍.</p><p>简单来说, <code>explicit</code>表达的是: 只允许显示行为, 不允许隐式行为.</p><p>要理解上面的解释, 就需要理解哪些是C++的显示行为, 哪些是隐式行为.</p><h2 id=显示行为和隐式行为>显示行为和隐式行为</h2><p>以下是cppreference的<a href=https://en.cppreference.com/w/cpp/language/explicit target=_blank rel="noopener noreffer">demo源码</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span>      <span class=c1>// converting constructor
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span> <span class=c1>// converting constructor (C++11)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>operator</span> <span class=nf>bool</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=nb>true</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=nf>B</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=nf>B</span><span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=k>operator</span> <span class=nf>bool</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=nb>true</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=n>a1</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>      <span class=c1>// OK: copy-initialization selects A::A(int)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span> <span class=n>a2</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>       <span class=c1>// OK: direct-initialization selects A::A(int)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span> <span class=n>a3</span> <span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span>   <span class=c1>// OK: direct-list-initialization selects A::A(int, int)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span> <span class=n>a4</span> <span class=o>=</span> <span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span> <span class=c1>// OK: copy-list-initialization selects A::A(int, int)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span> <span class=n>a5</span> <span class=o>=</span> <span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=mi>1</span><span class=p>;</span>   <span class=c1>// OK: explicit cast performs static_cast
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>a1</span><span class=p>)</span> <span class=p>;</span>      <span class=c1>// OK: A::operator bool()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>bool</span> <span class=n>na1</span> <span class=o>=</span> <span class=n>a1</span><span class=p>;</span> <span class=c1>// OK: copy-initialization selects A::operator bool()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>bool</span> <span class=n>na2</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a1</span><span class=p>);</span> <span class=c1>// OK: static_cast performs direct-initialization
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>//  B b1 = 1;      // error: copy-initialization does not consider B::B(int)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>B</span> <span class=n>b2</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>       <span class=c1>// OK: direct-initialization selects B::B(int)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>B</span> <span class=n>b3</span> <span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span>   <span class=c1>// OK: direct-list-initialization selects B::B(int, int)
</span></span></span><span class=line><span class=cl><span class=c1>//  B b4 = {4, 5}; // error: copy-list-initialization does not consider B::B(int,int)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>B</span> <span class=n>b5</span> <span class=o>=</span> <span class=p>(</span><span class=n>B</span><span class=p>)</span><span class=mi>1</span><span class=p>;</span>   <span class=c1>// OK: explicit cast performs static_cast
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>b2</span><span class=p>)</span> <span class=p>;</span>      <span class=c1>// OK: B::operator bool()
</span></span></span><span class=line><span class=cl><span class=c1>//  bool nb1 = b2; // error: copy-initialization does not consider B::operator bool()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>bool</span> <span class=n>nb2</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b2</span><span class=p>);</span> <span class=c1>// OK: static_cast performs direct-initialization
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>对类<code>A</code>来说, 以下是显示行为:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>A</span> <span class=nf>a2</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>       <span class=c1>// OK: direct-initialization selects A::A(int)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>A</span> <span class=n>a3</span> <span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span>   <span class=c1>// OK: direct-list-initialization selects A::A(int, int)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>A</span> <span class=n>a5</span> <span class=o>=</span> <span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=mi>1</span><span class=p>;</span>   <span class=c1>// OK: explicit cast performs static_cast
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>a1</span><span class=p>)</span> <span class=p>;</span>      <span class=c1>// OK: A::operator bool()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=n>na2</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a1</span><span class=p>);</span> <span class=c1>// OK: static_cast performs direct-initialization
</span></span></span></code></pre></td></tr></table></div></div><p><code>a2</code>和<code>a3</code>好理解, 因为就是直接调用<code>A</code>的构造函数, 这里不存在转换.</p><p><code>A a5 = (A)1;</code>存在转换, 但是是显示的, 这是用户明确需要转换的, 不是编译器的默认行为, 所以这里是显示转换.</p><p><code>if (a1) ;</code> 这里用户没有明确, 但是因为是<code>if</code>语句, 所以其<code>expression</code>是<code>bool</code>型的, 不存在编译器的隐式行为, 所以这里也可以认为是显示转换.</p><p><code>bool na2 = static_cast&lt;bool>(a1);</code> 同上, 这是用户明确的行为, 不是编译器的行为, 所以是显示转换.</p><p>以下是隐式行为:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>A</span> <span class=n>a1</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>      <span class=c1>// OK: copy-initialization selects A::A(int)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>A</span> <span class=n>a4</span> <span class=o>=</span> <span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span> <span class=c1>// OK: copy-list-initialization selects A::A(int, int)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=n>na1</span> <span class=o>=</span> <span class=n>a1</span><span class=p>;</span> <span class=c1>// OK: copy-initialization selects A::operator bool()
</span></span></span></code></pre></td></tr></table></div></div><p><code>a1</code>和<code>a4</code>, 会转换为<code>A(int)</code>和<code>A(int, int)</code>, 存在隐式转换.</p><p><code>bool na1 = a1;</code> 用户没有明确转换类型, 依赖于编译器的转换, 所以存在隐式转换.</p><p>以上分析了类<code>A</code>的行为, 对类<code>B</code>的构造和转换函数都加上了<code>explicit</code>说明, 所以对类<code>B</code>, 存在隐式行为的地方将不被允许.</p><p>在类<code>B</code>中以下是不被运行的隐式行为:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>B</span> <span class=n>b1</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>      <span class=c1>// error: copy-initialization does not consider B::B(int)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>B</span> <span class=n>b4</span> <span class=o>=</span> <span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span> <span class=c1>// error: copy-list-initialization does not consider B::B(int,int)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=n>nb1</span> <span class=o>=</span> <span class=n>b2</span><span class=p>;</span> <span class=c1>// error: copy-initialization does not consider B::operator bool()
</span></span></span></code></pre></td></tr></table></div></div><p>比如参考<a href=http://c.biancheng.net/cpp/biancheng/view/222.html target=_blank rel="noopener noreffer">这篇文章</a>中复数运算的例子:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Complex</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=n>Complex</span><span class=p>(</span> <span class=p>){</span><span class=n>real</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>imag</span><span class=o>=</span><span class=mi>0</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>   <span class=n>Complex</span><span class=p>(</span><span class=kt>double</span> <span class=n>r</span><span class=p>,</span><span class=kt>double</span> <span class=n>i</span><span class=p>){</span><span class=n>real</span><span class=o>=</span><span class=n>r</span><span class=p>;</span><span class=n>imag</span><span class=o>=</span><span class=n>i</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>   <span class=k>operator</span> <span class=nf>double</span><span class=p>(</span> <span class=p>)</span> <span class=p>{</span><span class=k>return</span> <span class=n>real</span><span class=p>;}</span> <span class=c1>//类型转换函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=kt>double</span> <span class=n>real</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=kt>double</span> <span class=n>imag</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=n>Complex</span> <span class=n>c1</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>),</span><span class=n>c2</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=o>-</span><span class=mi>10</span><span class=p>),</span><span class=n>c3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=kt>double</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=n>d</span><span class=o>=</span><span class=mf>2.5</span><span class=o>+</span><span class=n>c1</span><span class=p>;</span><span class=c1>//要求将一个double数据与Complex类数据相加
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>cout</span><span class=o>&lt;&lt;</span><span class=n>d</span><span class=o>&lt;&lt;</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>d=2.5+c1;</code>存在隐式行为. 所以如果我们给类型转换函数添加<code>explicit</code>说明后, 编译将不通过, 比如有如下错误:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;source&gt;:18:9: error: no match for &#39;operator+&#39; (operand types are &#39;double&#39; and &#39;Complex&#39;)
</span></span><span class=line><span class=cl>   18 |    d=2.5+c1;//要求将一个double数据与Complex类数据相加
</span></span><span class=line><span class=cl>      |      ~~~^~~
</span></span><span class=line><span class=cl>      |      |   |
</span></span><span class=line><span class=cl>      |      |   Complex
</span></span><span class=line><span class=cl>      |      double
</span></span></code></pre></td></tr></table></div></div><p>这时候就需要将<code>d=2.5+c1;</code>修改为显示的, 这样做<code>d=2.5+double(c1);</code>就可以了.</p><p>添加<code>explicit</code>说明后, 如果改成<code>d=2.5+float(c1);</code>编译器也会报错:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;source&gt;:18:10: error: invalid cast from type &#39;Complex&#39; to type &#39;float&#39;
</span></span><span class=line><span class=cl>   18 |    d=2.5+float(c1);//要求将一个double数据与Complex类数据相加
</span></span><span class=line><span class=cl>      |          ^~~~~~~~~
</span></span></code></pre></td></tr></table></div></div><p>这是很好的, 至少可以规范用户的行为, 用户需要明确知道当前应该是什么数据类型, 因此不会出现因为数据类型导致的超出预期的问题(比如精度或值域).</p><p>我尝试在Rust中寻找关于隐式行为的内容(因为我始终认为在默认行为部分Rust比C++做得更安全), 找到了<a href=https://rustmagazine.github.io/rust_magazine_2021/chapter_7/coercion_in_rust.html target=_blank rel="noopener noreffer">这部分</a>中的一句话:</p><blockquote><p>标准库中有一个函数std::mem::transmute，它可以将任意类型转换成其他类型。该函数是unsafe的，因为它不能保证输入类型的有效位可以表示为输出类型的有效位。确保这两种类型兼容由用户决定。</p></blockquote><p>这句话对我的启发是:</p><ol><li><p>所有代码的编译结果"基本"都一样, 那怎么保证代码的安全性? 可以交给人或者交给机器. 比如类型转换的功能, 如果交给人, 编译器就可以大量使用隐式转换, 但是用户就需要知道自己写的是什么, 是从什么转换成什么, 编译器对此会有什么样的行为, 不然就可能不安全. 如果交给机器, 机器是不相信人类的, 那么编译器就尽量不使用隐式转换, 用户就必须明确转换类型, 确保这些是编译器的允许行为, 不然编译器不允许通过. C++有不少的安全性是交由用户管理的, 所以我们可以写出很灵活的代码, 比如各种类型的隐式转换, 不容易被局限, 但是人也不总是那么可靠.</p></li><li><p>不要只局限于运行期, 编译期也能做很多事情, 不仅仅只有<code>template</code>. 比如可以在编译期做一些运算(判断/求和等等), 或者像类型检查一样做一些其他的检查等等, 这可能有点magic(元编程容易被这样认为), 但是需要有这种思维或者知识.</p></li></ol><h2 id=explicit-is-better-than-implicit>explicit is better than implicit</h2><p>这小结的标题是Python禅宗中的格言, 曾经读过, 但是今天不学习<code>explicit</code>的话, 可能还回忆不起这句话.</p><p>在<a href=https://lotabout.me/2021/Explicit-is-Better-than-implicit/ target=_blank rel="noopener noreffer">&ldquo;如何理解 Explicit is Better than Implicit?&rdquo;</a>中, 作者谈到了自己的理解, 我认为和<a href=/202108/sicp-python-read1/#%e5%87%bd%e6%95%b0%e6%8a%bd%e8%b1%a1 rel>《UCB CS61a SICP Python 中文》一周目笔记(一)
</a>中有部分观点是类似的:</p><ol><li>用户不会惊讶于函数的返回</li><li>用户不会惊讶于函数的输入</li></ol><p>显式行为就是我们通过代码就很容易理解的行为, 而不需要过多了解编译器将会怎么做, 这不仅仅局限于类型转换.</p><p>比如在"如何理解&mldr;&ldquo;这篇文章中, 作者举例的<code>read_csv</code>和<code>read_json</code>, 是很明显的显式行为, 输入文件名, 输出对应文件类型的内容/对象. 但是<code>read</code>也没那么差, 比如可以有两个类<code>CSV</code>和<code>JSON</code>, 那么他们各自有一个公共接口<code>read</code>, 通过这个接口可以返回对应文件类型的内容/对象, 这也是不错的, 我认为也是显式的.</p><p>怎么运用在自己的代码中? 我认为依赖于代码阅读量的积累. 需要阅读一些通用, 很多人使用过的代码(比如一些开源项目). 我自己写的时候, 也会考虑, 是不是见过类似的片段, 如果见过的, 我会大胆的写, 如果没见过的, 并且也没有其他想法的话, 我也会写下去. 想到围棋中的一个词描述: <strong>定式</strong>.</p><p>代码也是有定式的. 比如写一个线程池, 会怎么写? 我刚开始会想需要什么接口, 比如<code>add</code>啊, <code>start</code>啊, 等等, 慢慢这东西就会变成某项目专用的工具, 迁移性不高了. 但是比如这个超过1k fork/5k star的<a href=https://github.com/progschj/ThreadPool/blob/master/ThreadPool.h target=_blank rel="noopener noreffer">ThreadPool</a>, 接口很少, 这些是很值得学习的, 可以认为是定式, 代码量不大, 容易看懂. 我想起我们leader对我说的, 大概意思是: 写工具类先写一个通用的工具基类, 再根据项目需求添加功能更丰富的子类, 而不是一上来就根据项目需求开始动手了. 这种思想很有用, 再用线程池举例, 比如可以按照<a href=https://github.com/progschj/ThreadPool/blob/master/ThreadPool.h target=_blank rel="noopener noreffer">ThreadPool</a>实现一个只有<code>enqueue</code>方法的基类, 再按照需求实现有<code>start</code>/<code>stop</code>/<code>wait</code>功能之类的子类.</p></div><div class=post-footer id=post-footer><div class=orlike-box></div><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-12-23</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></div><div class=post-info-more><section><i class="fas fa-fw fa-th"></i>&nbsp;<a href=/categories/cpp/>Cpp</a></section><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/cpp/>Cpp</a></section></div><div class=post-nav><a href=/202112/talk-rssblogsource/ class=prev rel=prev title=rssblog的数据源-rssblog-source><i class="fas fa-angle-left fa-fw"></i>rssblog的数据源-rssblog-source</a>
<a href=/202112/stl-smartpointers/ class=next rel=next title=STL-智能指针三剑客源码阅读>STL-智能指针三剑客源码阅读<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=my-random-posts><div class=loadingThree><span></span>
<span></span>
<span></span>
<span></span>
<span></span></div></div><div id=comments><div id=giscus class=comment></div><script src=https://giscus.app/client.js data-repo=caibingcheng/comment data-repo-id=R_kgDOHgda4w data-category=Announcements data-category-id=DIC_kwDOHgda484CTfDe data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=/css/giscus.css data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/>giscus</a>.</noscript></div></article></div></main><footer class=footer><hr style=opacity:.2><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2024</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a href="https://icp.gov.moe/?keyword=20222231" target=_blank>萌ICP备20222231号</a></span></div><div class=footer-line><a href=https://wiki.imcbc.cn target=_blank rel=noopener title="Bing's Wiki">Wiki</a>
&nbsp;|&nbsp;
<a href=https://rssblog.cn target=_blank rel=noopener title=RSSBlog>RSSBlog</a>
&nbsp;|&nbsp;
<a href=https://travellings.link target=_blank rel=noopener title=开往-友链接力>开往-友链接力</a>
&nbsp;|&nbsp;
<a href=https://www.foreverblog.cn/go.html target=_blank>穿梭虫洞</a></div><div class=footer-line><script>var build_date="2024-03-05T21:35:50+08:00"</script>已运行
<span id=run-time></span>
&nbsp;|&nbsp;
构建于
<span id=build-time></span>&nbsp;前</div><div class=footer-line><script async src=https://npm.elemecdn.com/penndu@1.0.0/bsz.js></script>
共计
<span id=busuanzi_value_site_uv></span>&nbsp;访客
&nbsp;|&nbsp;
<span id=busuanzi_value_site_pv></span>&nbsp;访问
&nbsp;|&nbsp;
256K&nbsp;字</div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i>
</a><a id=reader-button class=fixed-button title=阅读模式><i class="fa fa-book fa-fw"></i></a></div><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/gh/Albejr/jquery-albe-timeline/jquery-albe-timeline.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/gh/caibingcheng/orlike@client/orlike.min.js></script><script type=text/javascript src=/js/custom.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"JMTHQS1VUU",algoliaIndex:"blog-bbing",algoliaSearchKey:"0dd43732743475449c844c0d0f21366a",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>
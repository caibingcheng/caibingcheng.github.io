<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>OMV硬件和软件升级 - Bing's Blog</title><meta name=keywords content="[Life bbing bing hugo Blog C++ LoveIt]"><meta name=Description content="个人技术博客"><meta property="og:title" content="OMV硬件和软件升级"><meta property="og:description" content="此前用废旧笔记本刷上OMV改了一个NAS，但总因为散热问题，当心着火（实际上温度一直不高）。因此，最近对家里的NAS做了一次软硬件的升级。"><meta property="og:type" content="article"><meta property="og:url" content="https://imcbc.cn/202212/omv-update/"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/caibingcheng/resources@main/images/13bOkrO.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-14T09:02:40+08:00"><meta property="article:modified_time" content="2022-12-14T09:02:40+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cdn.jsdelivr.net/gh/caibingcheng/resources@main/images/13bOkrO.png"><meta name=twitter:title content="OMV硬件和软件升级"><meta name=twitter:description content="此前用废旧笔记本刷上OMV改了一个NAS，但总因为散热问题，当心着火（实际上温度一直不高）。因此，最近对家里的NAS做了一次软硬件的升级。"><meta name=application-name content="Bing's Blog"><meta name=apple-mobile-web-app-title content="Bing's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://imcbc.cn/202212/omv-update/><link rel=prev href=https://imcbc.cn/202211/tagged-pointer/><link rel=next href=https://imcbc.cn/202212/2022-summary/><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/gh/Albejr/jquery-albe-timeline/templates/simple/style-albe-timeline.css><link rel=stylesheet href=https://fastly.jsdelivr.net/gh/caibingcheng/orlike@client/orlike.min.css><link rel=stylesheet href=/css/custom.css><meta name=google-site-verification content="xy1bCgQPV_H3_o2XD34o2mIByQxmzkV3GPOfhXg_mTM"><meta name=msvalidate.01 content="c81a65b6344571786df543a56c7bbe18"><meta name=baidu-site-verification content="code-WcyzWjgFYo"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"OMV硬件和软件升级","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/imcbc.cn\/202212\/omv-update\/"},"image":["https:\/\/imcbc.cn\/android-chrome-192x192.png"],"genre":"posts","keywords":"nas, omv, openwrt","wordcount":3408,"url":"https:\/\/imcbc.cn\/202212\/omv-update\/","datePublished":"2022-12-14T09:02:40+08:00","dateModified":"2022-12-14T09:02:40+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Bing","logo":"https:\/\/imcbc.cn\/android-chrome-192x192.png"},"author":{"@type":"Person","name":"bbing"},"description":""}</script></head><body header-desktop=normal header-mobile=normal><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/caibingcheng/ class=github-corner aria-label="View source on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Bing's Blog">Bing's Blog</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title><i class='fas fa fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/tags/ title><i class='fas fa fa-tag'></i> 标签 </a><a href=/categories/ title><i class='fas fa fa-th'></i> 分类</a></div></div><a class=menu-item href=/friends/><i class='fas fa fa-users'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa fa-angle-double-down'></i> 更多</a><div class="menu-more-content dropdown-content"><a href=/tools/ title><i class='fas fa fa-cubes'></i> 工具 </a><a href=/about/ title><i class='fas fa fa-address-card'></i> 关于 </a><a href=/timeline/ title><i class='fas fa fa-building'></i> 建站 </a><a href=/index.xml/ title><i class='fas fa fa-rss'></i> RSS</a></div></div><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章内容 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.cn/bbing class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://www.foreverblog.cn/go.html class=menu-item target=_blank rel=noopener title=穿梭虫洞><i class="fas fa-fw fa-life-ring" title=穿梭虫洞-随机访问十年之约友链博客></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Bing's Blog">Bing's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章内容 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a href=/posts/ class=menu-item title><i class='fas fa fa-archive'></i> 归档</a>
<a href=/tags/ class=menu-item title><i class='fas fa fa-tag'></i> 标签</a>
<a href=/categories/ class=menu-item title><i class='fas fa fa-th'></i> 分类</a>
<a class=menu-item href=/friends/><i class='fas fa fa-users'></i> 友链</a>
<a href=/tools/ class=menu-item title><i class='fas fa fa-cubes'></i> 工具</a>
<a href=/about/ class=menu-item title><i class='fas fa fa-address-card'></i> 关于</a>
<a href=/timeline/ class=menu-item title><i class='fas fa fa-building'></i> 建站</a>
<a href=/index.xml/ class=menu-item title><i class='fas fa fa-rss'></i> RSS</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class=single-title>OMV硬件和软件升级<sup>
<a id=reader-button-title title=阅读模式><i class="fa fa-book fa-fw"></i></a></sup></h1><div class=post-meta><div class=post-meta-line></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-12-14>2022-12-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3408 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#硬件升级>硬件升级</a><ul><li><a href=#笔记本换台式机>笔记本换台式机</a></li><li><a href=#openwrt硬件>openwrt硬件</a></li><li><a href=#千兆交换机>千兆交换机</a></li></ul></li><li><a href=#软件升级>软件升级</a><ul><li><a href=#用户权限共享目录>用户权限、共享目录</a></li><li><a href=#code-server>code-server</a></li><li><a href=#openwrt镜像>openwrt镜像</a></li></ul></li><li><a href=#小结>小结</a></li></ul></nav></div></div><div class=content id=content><p>此前用废旧笔记本刷上OMV改了一个NAS，但总因为散热问题，当心着火（实际上温度一直不高）。因此，最近对家里的NAS做了一次软硬件的升级。</p><h2 id=硬件升级>硬件升级</h2><p>硬件做的改造主要是：</p><ol><li><p>从笔记本换成了台式机；</p></li><li><p>将原本AIO的openwrt拆分出来，单独用一个小主机做openwrt的硬件设置；</p></li><li><p>客厅多媒体设备使用千兆交换机直连；</p></li></ol><h3 id=笔记本换台式机>笔记本换台式机</h3><p>从笔记本换台式机的需求之一是，尽可能的减少成本，在好朋友<a href=https://github.com/qhw0 target=_blank rel="noopener noreffer">@qhw0</a>的帮助下，定制了以下的台式机设备：</p><table><thead><tr><th>硬件</th><th>价格</th><th>备注</th></tr></thead><tbody><tr><td>七彩虹CQ1900M主板</td><td>110.00</td><td>咸鱼，包含4GB内存</td></tr><tr><td>台达NX350电源</td><td>70.00</td><td>咸鱼，不包含电源线</td></tr><tr><td>先马M2机箱</td><td>89.80</td><td>京东自营</td></tr><tr><td>金士顿240GB SSD</td><td>168.98</td><td>京东自营，笔记本拆机，但是买了不到两个月，算作原价</td></tr><tr><td>西数1TB 机械</td><td>0.00</td><td>五六年前买的，读写很少，平均成本算作0</td></tr><tr><td>SATA硬盘线</td><td>0.00</td><td>两三年前的剩余材料，平均成本算作0</td></tr><tr><td>电饭煲线</td><td>0.00</td><td>用作电源线，厨房有其他线可以给电饭煲使用</td></tr></tbody></table><p>以上总计：438.78元</p><p>在保证硬件性能不降低的情况下，以上设备可能不太好再降低预算了。（机箱可以换成鞋盒，但是又陷入了我当心的着火问题。）</p><p>七彩虹CQ1900M主板的特性有：</p><ol><li>集成赛扬J1900（四核四线程）CPU</li><li>TDP功耗15w</li><li>提供1个千兆有线网口</li><li>支持2个内存插槽（DDR3 1066/1333MHZ）</li><li>支持2个SATA 2.0接口</li><li>提供1个PCIE2.0 X16插槽，2个PCIE X1插槽</li><li>180mm*215mm mATX规格</li></ol><p>我主要是看中千兆网口，这是必须条件，需要注意，有些类似规格的主板或者mini主机不提供千兆网口。对于家庭NAS目的来说，2个内存插槽扩充到8GB内存也是完全足够使用的，目前4GB的容量也足够我使用。该主板只有2个SATA接口，除去一个系统盘，那么只剩下一个存储盘了，但是可以使用PCIE转SATA卡，用以提供更多的SATA接口。</p><p>我目前配置了一块SSD做系统盘，一块1TB机械做存储盘。没有配备CPU风扇或机箱风扇，没有遇到明显的发热问题。不过我这快机械盘的噪声有点大，会和机箱共振（机箱摆放在电视柜上），目前做法是在机箱的垫脚上垫了海绵以降低和电视柜的共振。</p><p>台达NX350是朋友推荐的，主要特性是输出功率稳定。该电源提供的SATA供电线只有三个，如果后期需要扩充硬盘的话，需要再接4Pin转SATA供电。不过目前的机箱只有2个3.5寸机械硬盘位，所以SATA电源线是足够使用的。</p><p>电饭煲线和机箱不太搭，一个白色的，一个黑色的，但是没必要再去买根线了。使用非原装电源线需要注意线材的负载，不过一般电饭煲电源线的负载是足够的（基本是2000w）。</p><h3 id=openwrt硬件>openwrt硬件</h3><p>在更换硬件之前，我使用的是All in One的方案，在OMV中使用docker运行openwrt，这样的问题有两个：</p><ol><li><p>host和docker通信不太会调，导致host不可以走代理，使用再增加一个macvlan的中转方案也没能解决这个问题；</p></li><li><p>网口限制，虽然局域网设备直连，但因为是AIO，所以共用网口和线路的最大速率，因此当心会有一些极端情况出现，继而影响家庭网络；</p></li></ol><p>参考了一些电视盒子，性价比都不太理想，最后采用的是J1800方案。在咸鱼上淘了一个二手盖网魔盒，135元，J1800集成主板，一个千兆网口，2.4G无线网卡，带2GB内存、16GB固态。</p><h3 id=千兆交换机>千兆交换机</h3><p>使用交换机主要是为了提高内网访问速率。因为是租的房子，埋的网线猜测是100M的（设备直连测速大概是200Mbps），不使用交换机的话，家庭的物理线路就会成为网络访问的最大瓶颈。在使用交换机之前的网络拓扑大致如下：</p><p><figure><a class=lightgallery href=https://bu.dusays.com/2022/12/14/6399ce78bd12e.png title=&amp;ldquo;使用交换机之前&amp;rdquo; data-thumbnail=https://bu.dusays.com/2022/12/14/6399ce78bd12e.png data-sub-html="<h2>使用交换机之前</h2><p>&amp;ldquo;使用交换机之前&amp;rdquo;</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://bu.dusays.com/2022/12/14/6399ce78bd12e.png data-srcset="https://bu.dusays.com/2022/12/14/6399ce78bd12e.png, https://bu.dusays.com/2022/12/14/6399ce78bd12e.png 1.5x, https://bu.dusays.com/2022/12/14/6399ce78bd12e.png 2x" data-sizes=auto alt=https://bu.dusays.com/2022/12/14/6399ce78bd12e.png></a><figcaption class=image-caption>使用交换机之前</figcaption></figure></p><p>因为家里是300Mbps的单宽带，又因为<code>路由器&lt;-->openwrt</code>的通路也认为可以达到300Mbps（一些小损失就忽略了），因此这时候可以认为访问外网不受影响。但是这时候内网访问nas的速率也最多只能到300Mbps，而且一般是无法持续维持的，并且又要“和外网共用线路”（参考上文的说法），这就不太合理了。（为什么不使用无线网络？一是无论使用mesh方案或者升级无线网卡都需要增加不少成本，二是实际体验不好，稳定性不足。（mesh方案没试验过，没钱））所以，此次改造的核心目的是提高nas和内网设备之间的物理线路的速度。</p><p>那么，在使用交换机+分离openwrt之后，家庭网络拓扑如下：</p><p><figure><a class=lightgallery href=https://bu.dusays.com/2022/12/14/6399ce78bd254.png title=&amp;ldquo;使用交换机+分离openwrt之后&amp;rdquo; data-thumbnail=https://bu.dusays.com/2022/12/14/6399ce78bd254.png data-sub-html="<h2>使用交换机+分离openwrt之后</h2><p>&amp;ldquo;使用交换机+分离openwrt之后&amp;rdquo;</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://bu.dusays.com/2022/12/14/6399ce78bd254.png data-srcset="https://bu.dusays.com/2022/12/14/6399ce78bd254.png, https://bu.dusays.com/2022/12/14/6399ce78bd254.png 1.5x, https://bu.dusays.com/2022/12/14/6399ce78bd254.png 2x" data-sizes=auto alt=https://bu.dusays.com/2022/12/14/6399ce78bd254.png></a><figcaption class=image-caption>使用交换机+分离openwrt之后</figcaption></figure></p><p>可以看到，nas和电脑/游戏机/电视之间可以通过千兆线路直连，对使用体验有明显提升，测试速度大概在800Mbps左右。当然，手机和nas之间的体验暂时还是想到又便宜又好的方案，不过手机对nas的访问比较少，目前也不需要大带宽。</p><p>以上，改造前后都在<code>openwrt</code>设备上标记了一个<code>lan</code>口，是为了说明使用的是单臂路由的方案，又因为是全双工，所以影响不是很大。</p><h2 id=软件升级>软件升级</h2><p>软件升级主要有：</p><ol><li><p>OMV5升级到OMV6；</p></li><li><p>重新设计用户权限和共享目录权限；</p></li><li><p>重新设定docker bind目录；</p></li><li><p>添加了code-server；</p></li><li><p>openwrt使用官方镜像；</p></li></ol><p>OMV5升级到OMV6只是因为换了设备，原来的系统复制到新设备上总有些问题，因此就索性刷了最新的OMV6，不过我个人认为UI还是好看了很多的，这是现在的仪表盘页面。</p><p><figure><a class=lightgallery href=https://bu.dusays.com/2022/12/14/6399d69aaa7cd.png title=OMV6 data-thumbnail=https://bu.dusays.com/2022/12/14/6399d69aaa7cd.png data-sub-html="<h2>OMV6</h2><p>OMV6</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://bu.dusays.com/2022/12/14/6399d69aaa7cd.png data-srcset="https://bu.dusays.com/2022/12/14/6399d69aaa7cd.png, https://bu.dusays.com/2022/12/14/6399d69aaa7cd.png 1.5x, https://bu.dusays.com/2022/12/14/6399d69aaa7cd.png 2x" data-sizes=auto alt=https://bu.dusays.com/2022/12/14/6399d69aaa7cd.png></a><figcaption class=image-caption>OMV6</figcaption></figure></p><h3 id=用户权限共享目录>用户权限、共享目录</h3><p>修改用户权限和控制共享目录主要是为了控制个人隐私，比如未来家里来了访客，是可以访问public权限的目录，这里只存放一些可以被所有人共享的内容，但是无法访问其他目录（比如存放媒体文件的一些目录）。那么，我的设计如下：</p><ol><li>两组用户：bing（我）具备最高权限，可以访问任意路径；public（访客）被我控制，只能访问部分路径；</li><li>共享目录一：Documents目录，SMB协议且公开，public用户具有递归的<code>wrx</code>权限，配置SMB时也要设置允许访客读写。我现在认为，在nas配置了多媒体服务的情况下，媒体文件就可以由这些服务管理（比如jellyfin、transmission），不再需要一个一个像文件一样被人手动管理（比如通过拷贝、复制、移动之类），因此，理应将这些文件隐藏起来，一般只允许通过多媒体服务来访问，那么对我来说，nas剩下的主要用途就是备份电脑文件和家庭照片，这时候就将可以通过映射将Documents目录当作电脑的普通硬盘用来备份即可；当然，照片也可以由nextcloud等服务管理，但是之前使用感受不算惊艳，因此目前没有继续配置该服务。</li><li>共享目录二：Meidas目录，不公开，给来jellyfin、transmission等挂载使用，由bing创建，权限可以是<code>700</code>，电影等文件就存放在该目录下。</li></ol><p>通过以上设置，就可以有以下使用场景：</p><ol><li><p>通过给jellyfin不同账号配置不同的媒体权限，因此实现分级制度，并且被管理的用户是确实看不到不被许可的内容的；</p></li><li><p>Documents可以随意访问，可以不设置密码；（仅内网）</p></li></ol><h3 id=code-server>code-server</h3><p>在之前的方案中就使用过code-server，但是因为host不能走docker openwrt的代理，因此没有继续使用了。在现在的方案中，这个问题不存在了，因此继续添加了这个服务。参考docker hub的配置还是很简单的，因此这里就简单贴一下我的配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>version: &#34;2.1&#34;
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  code-server:
</span></span><span class=line><span class=cl>    image: linuxserver/code-server:latest
</span></span><span class=line><span class=cl>    container_name: vscode
</span></span><span class=line><span class=cl>    environment:
</span></span><span class=line><span class=cl>      - PUID=1000
</span></span><span class=line><span class=cl>      - PGID=1000
</span></span><span class=line><span class=cl>      - TZ=Asia/Shanghai
</span></span><span class=line><span class=cl>      - SUDO_PASSWORD=2
</span></span><span class=line><span class=cl>    volumes:
</span></span><span class=line><span class=cl>      - /srv/xxxxxxxxxxxxxxx/config/vscode:/config
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>      - 8443:8443
</span></span><span class=line><span class=cl>      - 1313:1313
</span></span><span class=line><span class=cl>    restart: unless-stopped
</span></span></code></pre></td></tr></table></div></div><p>主要区别之处是绑定了<code>1313:1313</code>端口，这样就可以在code-server上运行<code>hugo server</code>，然后内网访问，以便测试了。本文就是在该code-server上写的，在家庭网络中，我可以在台式机上写，也可以在笔记本上写（有三台笔记本），达到了局域网下多设备同步的目的。相较于codespace，缺少了外网访问的功能，但是访问速度上是完胜，目前没有丝毫卡顿。（现在大爱这个功能！！！）</p><h3 id=openwrt镜像>openwrt镜像</h3><p>在AOI方案中，我是用的是lean的镜像，功能很多，但是很多都用不上。我使用openwrt只是为了全局代理，因此，在更换硬件设备后，就使用了官方镜像，然后按需安装插件。不过该镜像的问题是写死了分区大小，导致16GB的硬盘实际只能使用不到1GB，该问题我目前还没去折腾，因为不影响使用。</p><h2 id=小结>小结</h2><p>以上，主要修改还是硬件部分。因为硬件的修改，带来了软件使用体验的提升。这次折腾的主要收获还是了解到了一些网络设备，比如单臂路由、软路由等，也学会了简单分析家庭网络的物理瓶颈，比如通过绘制本文的网络拓扑图，又加深了我对现在家庭网络的认知。</p></div><div class=post-footer id=post-footer><div class=orlike-box></div><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-12-14</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></div><div class=post-info-more><section><i class="fas fa-fw fa-th"></i>&nbsp;<a href=/categories/%E5%B7%A5%E5%85%B7/>工具</a></section><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/nas/>nas</a>,&nbsp;<a href=/tags/omv/>omv</a>,&nbsp;<a href=/tags/openwrt/>openwrt</a></section></div><div class=post-nav><a href=/202211/tagged-pointer/ class=prev rel=prev title=tagged-pointer-让指针包含更多信息><i class="fas fa-angle-left fa-fw"></i>tagged-pointer-让指针包含更多信息</a>
<a href=/202212/2022-summary/ class=next rel=next title=2022年终总结>2022年终总结<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=my-random-posts><div class=loadingThree><span></span>
<span></span>
<span></span>
<span></span>
<span></span></div></div><div id=comments><div id=giscus class=comment></div><script src=https://giscus.app/client.js data-repo=caibingcheng/comment data-repo-id=R_kgDOHgda4w data-category=Announcements data-category-id=DIC_kwDOHgda484CTfDe data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=/css/giscus.css data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/>giscus</a>.</noscript></div></article></div></main><footer class=footer><hr style=opacity:.2><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2024</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a href="https://icp.gov.moe/?keyword=20222231" target=_blank>萌ICP备20222231号</a></span></div><div class=footer-line><a href=https://wiki.imcbc.cn target=_blank rel=noopener title="Bing's Wiki">Wiki</a>
&nbsp;|&nbsp;
<a href=https://rssblog.cn target=_blank rel=noopener title=RSSBlog>RSSBlog</a>
&nbsp;|&nbsp;
<a href=https://travellings.link target=_blank rel=noopener title=开往-友链接力>开往-友链接力</a>
&nbsp;|&nbsp;
<a href=https://www.foreverblog.cn/go.html target=_blank>穿梭虫洞</a></div><div class=footer-line><script>var build_date="2024-03-05T21:35:50+08:00"</script>已运行
<span id=run-time></span>
&nbsp;|&nbsp;
构建于
<span id=build-time></span>&nbsp;前</div><div class=footer-line><script async src=https://npm.elemecdn.com/penndu@1.0.0/bsz.js></script>
共计
<span id=busuanzi_value_site_uv></span>&nbsp;访客
&nbsp;|&nbsp;
<span id=busuanzi_value_site_pv></span>&nbsp;访问
&nbsp;|&nbsp;
256K&nbsp;字</div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i>
</a><a id=reader-button class=fixed-button title=阅读模式><i class="fa fa-book fa-fw"></i></a></div><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/gh/Albejr/jquery-albe-timeline/jquery-albe-timeline.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/gh/caibingcheng/orlike@client/orlike.min.js></script><script type=text/javascript src=/js/custom.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"JMTHQS1VUU",algoliaIndex:"blog-bbing",algoliaSearchKey:"0dd43732743475449c844c0d0f21366a",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>
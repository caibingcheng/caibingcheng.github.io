# 闲置笔记本改NAS-OMV踩坑记录


这不是一篇教程，所以不涉及omv从0到1的安装过程。网上教程很多，但是跟着做下来还是遇到很多问题（装了好几天>:），本篇的目的是记录我在omv安装过程中遇到的一些问题以及解决方法（不涉及原理）。

<!--more-->

### 0. 预备工具，官方链接。

- omv镜像: [https://www.openmediavault.org/](https://www.openmediavault.org/)
- U盘刻录工具: [https://www.balena.io/etcher/](https://www.balena.io/etcher/) （！！！用起来看着很干净！！！）

### 1. 为什么要将笔记本改NAS？

因为笔记本闲置很久了，大概7年前的笔记本，毕业之后就很少打开，所以打算把笔记本的存储和计算资源利用起来。相比较于买一个NAS，笔记本改的成本低很多，而且算力更牛逼，电费也不会高很多。

### 2. 为什么选OMV？

[github搜NAS](https://github.com/search?o=desc&p=2&q=NAS&s=stars&type=Repositories)，OMV按star数量排第一。

### 3. 先安装Debian在安装OMV还是直接安装OMV的镜像？

目的明确，直接使用OMV镜像。先安装Debian再安装OMV会有很多折腾的过程，而且我此前做法是不安装Debian的桌面环境，所以在配置网络的时候有些麻烦，随放弃。而官方OMV镜像也是包了一个Debian，所以在最终的结果上没有差别，各种配置在安装过程中，镜像的安装程序都帮你做好了，所以OMV镜像安装好后基本就能直接使用了。以下将通过OMV镜像安装的系统成为OMV系统。

### 4. 安装在哪？

我推荐安装在U盘。一是，OMV系统会禁止将系统盘作为存储盘使用，如果安装在大硬盘的话，就会损失很多存储空间，所以安装在U盘。二是，OMV系统有相关插件可以相对的延长U盘的使用寿命，所以无需太担心读写次数问题。三是，尽管打算利用笔记本的计算资源，但是也不可能像平常使用电脑那样长期利用，所以也相当于是小概率使用，大部分使用只是作为一个NAS。四是备份和移植方便，后期想换一个mini U盘，通过`dd`复制过去应该就行了。

### 5. 推荐安装时系统U盘和安装U盘插在同类型的USB接口。

我的笔记本只有一个USB3.0，试过一个插USB3.0一个插USB2.0，结果安装速度超级慢，两个都插USB2.0，则安装速度稍快。

### 6. 支持UEFI吗？

官方说支持，repo的issue上有讨论。但是我没弄成功，所以启动的时候需要关闭UEFI。

### 7. 硬盘格式化？

Debian的安装程序可以格式化硬盘，但是OMV的安装程序不能直接格式化，只可以选择安装硬盘，这导致OMV安装程序使用了大硬盘上的`/`分区（因为我试过安装在大硬盘上，但是这之后没有删除对应的分区）。可以在OMV安装程序中选择进入shell，使用fdisk指令清除硬盘分区。

### 8. raids？

这方面不太了解，我的设备尽管有两块硬盘但是不能组raids，原因说是这两块硬盘是通过USB链接的。因此可能是需要设备支持才可能支持raids，需要有心里准备。

### 9. 初始化

安装之后先在host机器上操作，需要注意登录之后屏幕上的提示指令，大概是`omv-firstaid`，这可以帮助配置机器的网络连接、omv终端的用户名/用户密码等。相比较于debian的安装，这可以减少很多折腾的过程。另外，因为是笔记本，所以需要设置**盖子关闭不挂起电脑**。

### 10. 更新

在客户端登录，一般是`omv.local`，这依赖于你安装omv时的配置，登录之后最好先更新系统，当然在服务器上更新也是可以的。

### 11. 一般配置

要记得先做一些基础配置，比如：硬盘格式化、硬盘挂载、建立用户、配置用户权限、建立共享文件夹、开启SSH、SMB等服务。以上完成后，可以在客户机器上看看是不是可以找到共享文件夹了，此时基本工作已经完成了。

### 12. 更多配置

除了做基础的网络存储，还可以实现多媒体等功能，但是这依赖于扩展插件，因此需要安装扩展插件，关键词是'omv-extra'，比如在这里可以找到[https://wiki.omv-extras.org/](https://wiki.omv-extras.org/)安装方法。上网址国内可以访问，但是其提供的链接是`github/raw`，因此如果需要直接使用的话，就需要在服务器上配置魔法（但是服务器可能当作下载器使用，如果配置魔法而没有配置关闭策略的话，可能导致流量超出）。因此，推荐的方式是在客户机上操作。客户机配置魔法是简单的，或者不配置魔法，推荐关注`fastgithub`项目，可以先将`omv-extra`的deb下载下来。然后再客户端上找到插件，将此deb上传并安装即可。

以上操作后，就可以看到`omv-extra`的tab了，把docker或者portainer等安装上，安装之后我们就可以在客户端为服务器安装docker服务了。以下是目前使用的：

1. jellyfin，免费的流媒体服务，目前使用下来是可以满足需求的，镜像是`linuxserver/jellyfin`，安装以及配置方式等，网上搜即可，配置最好是参考docker hub上对应image的说明即可。
2. transmisson，bt下载服务，可以不需要登录客户端，在客户机上直接下载内容到服务器上，十分的方便，镜像是`linuxserver/transmission`，如果第一个操作了，这个也就会安装了，配置同样看官方文档即可。

简单的多媒体方式，就可以在安装`omv-extra`后，在插件栏找到dlna即可，打开和配置dlna后，在家里也可以多设备访问服务器上的媒体文件了。

### -1. 使用感受

(2022-04-25T19:44:18+08:00)

用了一周多了, 已经冷静下来没那么折腾了. 现在主要用的依然是上述的两个插件`transmisson`和`jellyfin`.

这几天在家的时候都会找很多资源, 然后交给`transmisson`去下载, 有些可能需要下载好几天, 有些可能睡觉起来就好了, 总之会比使用主力机器下载省心不少(因为24h运行). 不过下载好后, 需要人工登录共享文件夹整理下载之后的内容. 虽然`transmisson`可以在下载完成之后执行一些用户自定义脚本, 我也尝试了一下, 然后`transmisson`就蹦了:<

`jellyfin`可以自动扫描指定目录的变更, 但是目前使用起来并没有那么迅速, 所以有时候我也会登录admin账户手动下达重新扫描的指令, 如果不是很着急的话, 等待一段时间, `jellyfin`基本也是可以帮助扫描的. 相比与`DLNA`, `jellyfin`尽管感知更新的速度比较慢, 但是在其他的用户体验上要智能得多, 可以指定扫描的路径, 可以自定义媒体库(分类), 还可以在空闲的时候自动更新媒体文件的一些meta信息, 比如海报/演员信息等等. Android也有`jellyfin`的客户端, 总之, 目前使用`jellyfin`的体验是比较好的.

至于虚拟机我并没有尝试配置, 因为机器性能不算很好, 而且主力机可以覆盖我的需求, 所以目前就把这个笔记本当作媒体设备了.

U盘系统体验下来的感觉并不是很好, 主要是速度太慢了. 但是又不想浪费一块硬盘, 所以目前依然使用的是U盘系统. 不过, 如果只是作为一个多媒体设备的话, U盘系统还是没问题的.

最后, 有时候会担心笔记本着火了...所以不在家的时候可能会时不时看看家里的监控...

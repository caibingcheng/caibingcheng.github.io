<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>《现代C++白皮书》一周目读后感 - Bing's Blog</title><meta name=keywords content="[Life bbing bing hugo Blog C++ LoveIt]"><meta name=Description content="个人技术博客"><meta property="og:title" content="《现代C++白皮书》一周目读后感"><meta property="og:description" content="最近在读C++之父 Bjarne Stroustrup 关于 HOPL4（History of Programming Language，约十五年举办一次）会议的论文，以下称白皮书。主要讲述的是C++98到C++20的语言发展历史，包括一些语言特性和基础库的由来和相关讨论，以及为什么有些是语言特性，有些变成了基础库。了解语言发展历史，有助于理解语言设计的核心思想。"><meta property="og:type" content="article"><meta property="og:url" content="https://imcbc.cn/202209/cpp_hopl4_reading/"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/caibingcheng/resources@main/images/13bOkrO.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-27T22:06:08+08:00"><meta property="article:modified_time" content="2022-09-27T22:06:08+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cdn.jsdelivr.net/gh/caibingcheng/resources@main/images/13bOkrO.png"><meta name=twitter:title content="《现代C++白皮书》一周目读后感"><meta name=twitter:description content="最近在读C++之父 Bjarne Stroustrup 关于 HOPL4（History of Programming Language，约十五年举办一次）会议的论文，以下称白皮书。主要讲述的是C++98到C++20的语言发展历史，包括一些语言特性和基础库的由来和相关讨论，以及为什么有些是语言特性，有些变成了基础库。了解语言发展历史，有助于理解语言设计的核心思想。"><meta name=application-name content="Bing's Blog"><meta name=apple-mobile-web-app-title content="Bing's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://imcbc.cn/202209/cpp_hopl4_reading/><link rel=prev href=https://imcbc.cn/202209/nas-omv-reprocesss/><link rel=next href=https://imcbc.cn/202209/gunpg-commiter-sign/><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/gh/Albejr/jquery-albe-timeline/templates/simple/style-albe-timeline.css><link rel=stylesheet href=https://fastly.jsdelivr.net/gh/caibingcheng/orlike@client/orlike.min.css><link rel=stylesheet href=/css/custom.css><meta name=google-site-verification content="xy1bCgQPV_H3_o2XD34o2mIByQxmzkV3GPOfhXg_mTM"><meta name=msvalidate.01 content="c81a65b6344571786df543a56c7bbe18"><meta name=baidu-site-verification content="code-WcyzWjgFYo"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"《现代C++白皮书》一周目读后感","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/imcbc.cn\/202209\/cpp_hopl4_reading\/"},"image":["https:\/\/imcbc.cn\/android-chrome-192x192.png"],"genre":"posts","keywords":"HOPL, Cpp","wordcount":6736,"url":"https:\/\/imcbc.cn\/202209\/cpp_hopl4_reading\/","datePublished":"2022-09-27T22:06:08+08:00","dateModified":"2022-09-27T22:06:08+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Bing","logo":"https:\/\/imcbc.cn\/android-chrome-192x192.png"},"author":{"@type":"Person","name":"bbing"},"description":""}</script></head><body header-desktop=normal header-mobile=normal><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/caibingcheng/ class=github-corner aria-label="View source on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Bing's Blog">Bing's Blog</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title><i class='fas fa fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/tags/ title><i class='fas fa fa-tag'></i> 标签 </a><a href=/categories/ title><i class='fas fa fa-th'></i> 分类</a></div></div><a class=menu-item href=/friends/><i class='fas fa fa-users'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa fa-angle-double-down'></i> 更多</a><div class="menu-more-content dropdown-content"><a href=/tools/ title><i class='fas fa fa-cubes'></i> 工具 </a><a href=/about/ title><i class='fas fa fa-address-card'></i> 关于 </a><a href=/timeline/ title><i class='fas fa fa-building'></i> 建站 </a><a href=/index.xml/ title><i class='fas fa fa-rss'></i> RSS</a></div></div><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章内容 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.cn/bbing class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://www.foreverblog.cn/go.html class=menu-item target=_blank rel=noopener title=穿梭虫洞><i class="fas fa-fw fa-life-ring" title=穿梭虫洞-随机访问十年之约友链博客></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Bing's Blog">Bing's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章内容 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a href=/posts/ class=menu-item title><i class='fas fa fa-archive'></i> 归档</a>
<a href=/tags/ class=menu-item title><i class='fas fa fa-tag'></i> 标签</a>
<a href=/categories/ class=menu-item title><i class='fas fa fa-th'></i> 分类</a>
<a class=menu-item href=/friends/><i class='fas fa fa-users'></i> 友链</a>
<a href=/tools/ class=menu-item title><i class='fas fa fa-cubes'></i> 工具</a>
<a href=/about/ class=menu-item title><i class='fas fa fa-address-card'></i> 关于</a>
<a href=/timeline/ class=menu-item title><i class='fas fa fa-building'></i> 建站</a>
<a href=/index.xml/ class=menu-item title><i class='fas fa fa-rss'></i> RSS</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class=single-title>《现代C++白皮书》一周目读后感<sup>
<a id=reader-button-title title=阅读模式><i class="fa fa-book fa-fw"></i></a></sup></h1><div class=post-meta><div class=post-meta-line></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-09-27>2022-09-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 6736 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 14 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#c是一门全新的语言>C++是一门全新的语言</a></li><li><a href=#c11是迈向现代化的一步>C++11是迈向现代化的一步</a></li><li><a href=#c14---c17小版本升级>C++14 - C++17小版本升级</a></li><li><a href=#c20大版本升级>C++20大版本升级</a></li><li><a href=#关于学习编程语言的观点>关于学习编程语言的观点</a></li></ul></nav></div></div><div class=content id=content><p>最近在读C++之父 Bjarne Stroustrup 关于 HOPL4（History of Programming Language，约十五年举办一次）会议的论文，以下称白皮书。主要讲述的是C++98到C++20的语言发展历史，包括一些语言特性和基础库的由来和相关讨论，以及为什么有些是语言特性，有些变成了基础库。了解语言发展历史，有助于理解语言设计的核心思想。</p><p>类似的，这是一篇一周目的读后感（22.06.18开始写&mldr;到现在三个多月了, 实际上差不多二周目），同<a href=/tags/sicp/ rel>SICP系列（目前还在一周目&mldr;）</a>的理念，我认为上述论文也是值得多次拜读的，积累一定知识后再开启多周目肯定会有不一样的收获。</p><p>本篇读后感和SICP笔记的区别是，读后感是读完全文的所想，笔记是读完每一章节的所学和所想。</p><p>中文译版下载：<a href="https://1drv.ms/b/s!Aj0V_vhxaL7QuXIPbOXIvxGpulRh?e=G61aZ4" target=_blank rel="noopener noreffer">在这里</a></p><h2 id=c是一门全新的语言>C++是一门全新的语言</h2><p>首先，我们需要再一次重新认识到，C++并不是C的补充，也不是C的扩展，C++是一门全新的语言，我甚至认为这种认识是十分重要的。认识到C++是一门全新的语言将对我们的编码风格、组织以及思考方式都有帮助。在Stroustrup早期著作《C++语言的设计和演化》中，有这样一张图说明这种语言的演化关系：</p><p><figure><a class=lightgallery href=https://bu.dusays.com/2022/09/27/6332fb05ab9c7.png title=“C++的演化历史” data-thumbnail=https://bu.dusays.com/2022/09/27/6332fb05ab9c7.png data-sub-html="<h2>C++的演化历史</h2><p>“C++的演化历史”</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://bu.dusays.com/2022/09/27/6332fb05ab9c7.png data-srcset="https://bu.dusays.com/2022/09/27/6332fb05ab9c7.png, https://bu.dusays.com/2022/09/27/6332fb05ab9c7.png 1.5x, https://bu.dusays.com/2022/09/27/6332fb05ab9c7.png 2x" data-sizes=auto alt=https://bu.dusays.com/2022/09/27/6332fb05ab9c7.png></a><figcaption class=image-caption>C++的演化历史</figcaption></figure></p><p>同样的，因为我最近在学习Objective-C，有很多人说OC是C语言的超集，实际上是不对的，如果把OC认为是C语言的超集那应该是大错特错了。我们只能说，OC兼容了或者大部分兼容了C，两个不是同一种东西，包括代码的编写和设计思想都不应该一样。需要了解这种区别，我认为需要了解了解Smalltalk这门语言。</p><p>最开始的C with Classes是通过C和Simula演化而来的，而后参考其他诸多语言演化为了C++，当然，就如Stroustrup所说，C++有很多特性也是通过长期实验和实践而得来的，更像是一个经验老道的工程师。</p><p>C with Classes最开始的目标是像C一样可以直接而高效的处理硬件，又可以像Simula一样组织代码。我认为C with Classes的说法，可能是将大部分人引入把C++看作是一门面向对象语言这样的一种误区的原因。其实很多教科书或者参考书都会说明（尽管他们的大多数还是说C++是一门面向对象的语言），C++也可以面向过程，函数式编程、泛型编程等等，尽管这些定义会和面向对象有所关联，但是理应区分他们之间的关系，这些定义是关系到代码组织方式和思考方式的。这种认知和“C++是一门全新的语言”一样重要，就如我在工作中经常会看到有人不假思索的就说“把XX定义为一个类”之类的说法，始终觉得很奇怪，万物都是对象吗？我想是的，万物都可以是对象，但是是不是万物都应该看作是对象？值得思考，现在主流观点都说万物皆对象，尽管我对此持怀疑的态度，但是大部分时候不得不随波逐流。</p><p>关于C++，我们经常会提到“零开销抽象”，到现在为止我也不能十分地理解该描述地含义，Stroustrup对此的解释是：</p><ol><li>你不用的东西，你就不需要付出代价</li><li>你使用的东西，你手工写代码也不会更好</li></ol><p>我的个人看法，“零开销抽象”是一种被C++采用，而被诸如Python、Javascript等解释器语言抛弃的设计哲学，因为解释器是runtime的，所以总有用户设计之外的开销，而类似Java因采用JVM机制，所以也不符合“零开销抽象”的设计哲学。在“零开销抽象”的设计框架下，用户或编译器更像是一个专家，需要考虑到更细致的东西，介错人的角色只会出现在用户的脑子里或者编译期（rust的编译器就像是编译期的介错人）。而在一些其他语言中（比如解释型），用户就是用户，不需要考虑太多，专心将思路转化为代码即可，介错人会在运行期出现。</p><p>关于C++用户更像一个专家的说法，我想到了一种解释。因为最近在看OC，OC主要参考自Smalltalk的设计思想，Smalltalk的一个思想是&ndash;创造性。用户不仅仅是程序的使用者，也是程序的开发者。那么这时候的语言设计就需要简单，用户不需要特别的了解各种不同的硬件构造，他们只需要把他们的想法表达出来即可。换句话说，我的理解是，C++是站在机器角度思考问题的，所以用户需要迎合它；Smalltalk是站在用户角度思考问题的，所以用户只需要关心自己。这么看来，C++用户会渐渐成为专家，而Smalltalk用户会渐渐成为资深用户（产品用户，就好像熟悉Windows系统一样）。（Smalltalk的设计目的，用现在的话语说就是一套操作系统 + 编程语言 + IDE的集成环境，用户在获得计算机后，会学习如何使用计算机，因为计算机的软件和环境全部由Smalltalk编写，那么这个过程中，用户也就慢慢学会了如何使用Smalltalk，那么他就会学会如何编程，而这个过程是不太需要像现在这样专门去学习编程课程的。）</p><p>（还是回到C++吧，几个祖师爷级别的语言还是得找时间大概学习学习的。）</p><p>早期C++的发展史，是C++类的成长史。从白皮书所列的年表可以看到98年以前C++的发展主要是围绕类来展开的（当然，可能也有其他核心工作，但是我没读过其他HOPL的论文，而白皮书中也为着重介绍早期C++的发展，所以认知到此为止）。Stroustrup提到，C++的核心是构造函数和析构函数，在早期对应的是<code>new</code>和<code>delete</code>操作，但是不仅仅是指代内存，而是一切资源。我认为，不要把析构、构造函数和面向对象同等看待，他们不是包含或者被包含的关系，而更像是有所交集的两个不同集合，包含析构和构造的对象只是面向对象的一种实现方式而已。通过构造和析构，可以演化出C++的RAII设计哲学，这种设计可能成为C++不那么需要GC的论据之一。</p><p>在1980年代期间，又为C++类提供了继承、虚函数、重载、纯虚函数的支持。这是C++的类和Python或者Javascript等不同之处，多态迫使C++用户写出更加抽象的代码，迫使用户从问题中寻找更高层次的解释。我遇到有人会比较排斥多态，认为过度封装，但是我个人看来只是能力不够（也可能是认为“可以运行就可以了”，这是很多人会持有的态度，我有时候也会）。</p><p>C++98是大多数人学习的第一个C++版本，在98版本中，添加了模板、异常、namespace等语言特性，RAII的技术也是在C++98版本中确立的（很早就是这种技术，只是没有名字），此外，跟随C++98发布的，还有STL、智能指针等标准库。RAII和智能指针的出现否定了C++对GC的需求，namespace将构建复杂而庞大的库变得更容易（C++20的包也可以改变代码的组织方式和编译方式），模板的标准化催生了新的、图灵完备的编程流派&ndash;泛型编程（更早的时候也有）。</p><p>现在C++的很多特性在21世纪初就已经初见模型，可能因为标准化的原因，很多推迟了十几年、二十几年才得以发布。似乎强大的标准委员会在某些程度上来说，也阻碍了C++的发展和壮大。</p><h2 id=c11是迈向现代化的一步>C++11是迈向现代化的一步</h2><p>我刚开始学的C++是C++98，所以学习C++11的时候，颇有一种“这是啥？”的想法，两个版本的跨度对我来说相当不小，而C++11到C++17之间的跨度，却几乎是无感的。当然到了C++20，又有不小的改动，尽管很多概念都是近乎二十年前的。</p><p>C++11和之前的版本相比，富有现代感，加入了如下更新：</p><ol><li>auto推导</li><li>范围for</li><li>统一初始化</li><li>移动语义，如右值引用和std::move</li><li>用nullptr指代空指针</li><li>constexpr函数</li><li>lambda表达式</li><li>强枚举类型enum class</li><li>变参模板</li><li>扩展using意义，类型重命名、别名</li><li>unique_ptr和shared_ptr，扩充了依赖RAII的资源管理指针</li><li>aotmic变量</li><li>标准thread库</li><li>future-promise、packaged_task模型</li><li>type trait，更丰富的模板元编程</li><li>etc.</li></ol><p>我想补充关于对nulltpr的认识。此前我找过一段时间关于nullptr的实现原理，最终得到了一种可信任的解释。nulltpr是语言上面更新，对nulltpr的支持是编译器层面的，而不是简单的认为对NULL的替换。</p><p>如果对这些更新分类，我想可以是：</p><ol><li>用户层面的更新，这里的用户是程序员，减少劳动成本，比如auto推导、范围for、lambda表达式等</li><li>语言哲学的更新，是对语言认知转变的更新，比如nullptr、移动语义、内存模型等</li></ol><p>用户更新偏向上层，语言哲学更新偏向底层。用上一节的话说，用户更新更倾向于smalltalk，让用户更具创造力；语言哲学更新更倾向于C++本身，让用户更像是专家。</p><p>言归正传，以上是语言自身的更新和标准库的更新，有部分没有列出，从我的浅见来看，最重要的更新是：</p><ol><li>移动语义，减少内存拷贝，提高软件性能</li><li>对模板、类型的支持，丰富元编程技术</li><li>对内存模型的更新</li><li>对多线程标准库的支持，再也不用三方库了</li></ol><p>我认为，这些更新让C++代码写起来更加现代化（我想的是和Python对比，会比较像了）。因为更多标准库的支持，此前不少复杂的特性、写法也变得更加简单和统一。比如范围for、thread库之类。</p><p>此外，C++11还有内存模型上的更新，这可能是最重要的更新，但是我对此暂时还不太了解，因此暂时略过。至于emplace运算之类，我认为是移动语义的附属产品。还有time库、random库之类，因为用的比较少，所以对此了解也不多。</p><p>到这里，我也想到了我们大学的C++教材，使用的是C++98的版本 &ndash; 说的就是《C++程序设计》。极其复杂和无聊的解说，把对C++语言的学习就当做是对一些条条框框的背诵和记忆，没有为什么，没有怎么来。所以那时候很多同学也学不下去，对这东西没什么兴趣。在我认识的同学里面，应该是没有因为这个教材喜欢上C++的，基本都是完全自学的。</p><p>在该译文中，Stroustrup也如是说：</p><blockquote><p>直到 2018 年，我仍能看到 C++98 前的编译器被用于教学。我认为这是对学生的虐待，剥夺了他们接触学习我们 20 多年的进展的机会。</p></blockquote><p>（我们被要求用的编译器是Borland C&mldr;）</p><p>不过，C++11如此大的变动，也导致了很多公司更新的困难，这意味着很多代码可能需要重写。在我工作一段时间之后，对此有很明显的感觉。公司使用的平台源代码，使用的是C++98的标准，最近几个release版本才可以从中看到部分C++11及以上的特性。公司很多老员工也是使用的C++98标准，或者是C with class。</p><p>总结其原因，大概率还是因为老教材不更新，以及版本特性差别较大导致的切换和学习困难。</p><h2 id=c14---c17小版本升级>C++14 - C++17小版本升级</h2><p>我认为C++14-C++17是C++11的小版本（小数点版本）升级，当然这是个人看法，按照ISO的计划，C++11后的每3年的都是一次（等同的）常规版本升级。</p><p>依照Stroustrup的说法，C++14是：</p><blockquote><p>依据大版本和小版本交替发布的计划，C++14的目标是“完成C++11”</p></blockquote><p>其更新概括为：</p><ol><li>字面量更新和支持数字分隔符</li><li>变量模板</li><li>函数返回值auto推导和lambda参数auto推导</li><li>constexpr函数支持局部变量</li><li>移动捕获</li><li>按类型访问元组（这部分可以看之前的文章<a href=/202207/cpp-stl-tuple#get rel>《STL-tuple源码阅读》</a>）</li></ol><p>日常用得多的是对auto推导的扩充和对constexpr函数的扩充。</p><p>使用auto扩充，可以写出更统一格式代码。对lambda表达式的输入输出基本统一，但是对函数输入来说，目前还没有auto支持。不过，在C++20版本中也指出了这种auto推导相对于template推导的缺陷，在概念引入后，也会慢慢修复这些缺陷。</p><p>使得constexpr函数可以支持局部变量，则允许写出更具通用性的编译期代码。可能有利有弊吧。对于程序开发人员来说，将有条件写出性能更好的代码；但是对于编译器开发人员来说，使得提高编译速度这项issue更具挑战性。</p><p>C++17被当做了大版本升级，添加了如下内容：</p><ol><li>构造函数模板推导和推导指引，如可以<code>shared_lock lck {m};</code>而不用再<code>shared_lock&lt;mutex> lck {m};</code></li><li>结构化绑定</li><li>复制消除，减少拷贝</li><li>更严格的表达式求值顺序，减少未定义行为，可以参考<a href=/202110/ppi-ipp-func#%e5%8f%82%e6%95%b0%e8%ae%a1%e7%ae%97%e9%a1%ba%e5%ba%8f%e5%92%8c%e5%85%a5%e5%8f%82%e9%a1%ba%e5%ba%8f rel>《i++和++i在函数入参时的一些问题
》</a></li><li>对optional、any、variant的支持，any源码可以参考<a href=/202207/cpp-stl-any rel>《STL-any源码阅读
》</a></li><li>etc</li></ol><p>可以看到C++17也没有像C++11这样的巨大改动，更多的是补充和优化。</p><p>在文中，Stroustrup提到了“结构化绑定”这一特性的由来，他说：</p><blockquote><p>而正当 2015 年 11 月底在科纳 Ville Voutilainen 刚要结束 EWG 会议时，我注意到我们离午饭还有 45 分钟，我觉得小组应该会想要看到这个提案。2015 年科纳的会议是我们冻结 C++17 的功能集的时间点，所以这 45 分钟很关键。我们甚至没时间去另一个小组找到 Herb，我就直接讲了这个提案。EWG 喜欢这个提案，会议纪要说鼓掌以资鼓励；EWG 想要这样的东西。</p></blockquote><p>他说的是关于<code>auto {x,y,z} = f();</code>这类表达式的提案（由Herb Sutter建议），不只是支持<code>tuple</code>，也支持<code>struct</code>的结构化绑定。令我觉得有意思的，他们的工作就像是学生，没有很强的上下级（可能因为他级别本来就高），卡着饭点前的45分钟提出了这个提案，还通过了。很羡慕这种工作氛围。</p><h2 id=c20大版本升级>C++20大版本升级</h2><p>C++20的大更新就是关于概念的引入。（我目前并没有关心最近的C++20发版工作）</p><p>关于概念的写法，我是更偏向于Stroustrup的自然派，当然在C++20中采用的是一种折中写法。</p><p>当出现类型的时候，一般想的是“给我一个某某类型”，这是非常具体的；然后出现了模板，这时候会想“随便给我一个XX我就能YY”，这是非常宽泛的，覆盖所有可能性；然后有了<code>enable_if</code>，这时候想的是“给我一个满足XX条件的YY我才能ZZ”，是介于类型和普通模板之间的一种相对比较宽泛的东西。如果用集合描述，类型就是只有一个元素的集合，普通模板是全集，<code>enable_if</code>是子集，这三种描述方法基本可以表达所有可能的组合的情况了。</p><p>概念的出现，在我看来是对上述三种情况的统一，而不仅仅是为了简化复杂的<code>enable_if</code>的写法，当然，要是仅凭我现在的认知，我还是认为基础类型是不少的。有了概念之后，普通类型可以描述为“XX类型是类型为XX类型的类型”，普通模板可以描述为“XX类型是类型为任意类型的类型”，<code>enable_if</code>则描述为“XX类型是满足以下YY等条件的类型”。都是共用一套描述方法，所以我会更倾向于自然派写法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>auto</span> <span class=nf>sum</span><span class=p>(</span><span class=n>Iteratable</span> <span class=n>iter</span><span class=p>)</span> <span class=p>{</span><span class=c1>//...}
</span></span></span></code></pre></td></tr></table></div></div><p><code>Iteratable</code>是一个概念或者模板，普通类型也可以，但是引入概念之后都当作我们曾经认知的普通类型来看待。Stroustrup一派的想法是让泛型编程变得和普通编程一样，可惜的是，C++20中并没有采用概念自然表示的写法，而是一种复杂的写法和所谓简写法：</p><p>最仔细的写法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>S</span><span class=o>&gt;</span> <span class=k>requires</span> <span class=n>Sortable</span><span class=o>&lt;</span><span class=n>S</span><span class=o>&gt;</span> <span class=kt>void</span> <span class=n>sort</span><span class=p>(</span><span class=n>S</span><span class=o>&amp;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>稍简化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=n>Sortable</span> <span class=n>S</span><span class=o>&gt;</span> <span class=kt>void</span> <span class=n>sort</span><span class=p>(</span><span class=n>S</span><span class=o>&amp;</span><span class=p>);</span> 
</span></span></code></pre></td></tr></table></div></div><p>简化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>Sortable</span> <span class=k>auto</span> <span class=nf>sort</span><span class=p>(</span><span class=n>Sortable</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>s</span><span class=p>);</span> 
</span></span></code></pre></td></tr></table></div></div><p>就算最简单的写法，也没有脱离模板的影子，仍然要用一个auto标识符，来说明这是一个概念/模板。</p><p>此外的更新还有：</p><ol start=0><li>引入概念</li><li>引入模块</li><li>对协程库的支持</li><li>etc.</li></ol><p>对于概念、模块、协程库还得多写写才能深刻体会，概念和模块虽然Stroustrup说是很老的东西了，但是对我来说还是很新，得多写多用多体会；关于协程，此前看过一些实现方法，比如云风的方案。之后会输出关于协程的文章。</p><h2 id=关于学习编程语言的观点>关于学习编程语言的观点</h2><p>这是一段简短的个人观点，现在时间是2022年09月27日。</p><p>以我学生时期的思想来说，学习一门编程语言很简单，我一度认为学会某种（比如C、C++）之后再学习其他的就会很简单。所以那时候会学习很多编程语言。</p><p>但是现在我并不持有这种观点，如果对C或C++一类有颇深的执念，再学习其他语言可能会更难。我想说的就是“思想、灵魂”。比如Python、JavaScript、C、C++，虽然相似，但是编程思想、代码结构并不是一样的，语言、语法只是皮囊罢了。因为我此前的观点，导致我写Python、JavaScript都会像写C/C++一样，这就是完全没学会嘛！写出来的是四不像。甚至最近在看OC的时候，我还想说，这TM是什么东西，怎么会有这种语言？！其实还是见识少了。</p><p>所以，学习编程语言，不只是学习语法、关键词；还需要学习对应语言的编程思想、代码结构、语言发展史（说的就是OC，看了OC的发家史，我才觉得，牛啊，这语言的思想好！！！有意思。）。这就像我们学习外语一样，背单词、学语法总是达不到native speaker的水平，说到底还是我们缺少对语言文化和思想的学习。</p><p>虽然这篇HOLP没有对C++知识点的详细叙述，但是其描述的历史过程、提案过程，确实帮助我加深了对C++的理解，也有查漏补缺，也有了解各个版本区别。之后的我将更向C++ native programmer靠近。</p></div><div class=post-footer id=post-footer><div class=orlike-box></div><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-09-27</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></div><div class=post-info-more><section><i class="fas fa-fw fa-th"></i>&nbsp;<a href=/categories/cpp/>Cpp</a>,&nbsp;<a href=/categories/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/>软件设计</a></section><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/hopl/>HOPL</a>,&nbsp;<a href=/tags/cpp/>Cpp</a></section></div><div class=post-nav><a href=/202209/nas-omv-reprocesss/ class=prev rel=prev title=NAS-OMV容器配置><i class="fas fa-angle-left fa-fw"></i>NAS-OMV容器配置</a>
<a href=/202209/gunpg-commiter-sign/ class=next rel=next title=使用GPG防止commiter冒充>使用GPG防止commiter冒充<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=my-random-posts><div class=loadingThree><span></span>
<span></span>
<span></span>
<span></span>
<span></span></div></div><div id=comments><div id=giscus class=comment></div><script src=https://giscus.app/client.js data-repo=caibingcheng/comment data-repo-id=R_kgDOHgda4w data-category=Announcements data-category-id=DIC_kwDOHgda484CTfDe data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=/css/giscus.css data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/>giscus</a>.</noscript></div></article></div></main><footer class=footer><hr style=opacity:.2><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2024</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a href="https://icp.gov.moe/?keyword=20222231" target=_blank>萌ICP备20222231号</a></span></div><div class=footer-line><a href=https://wiki.imcbc.cn target=_blank rel=noopener title="Bing's Wiki">Wiki</a>
&nbsp;|&nbsp;
<a href=https://rssblog.cn target=_blank rel=noopener title=RSSBlog>RSSBlog</a>
&nbsp;|&nbsp;
<a href=https://travellings.link target=_blank rel=noopener title=开往-友链接力>开往-友链接力</a>
&nbsp;|&nbsp;
<a href=https://www.foreverblog.cn/go.html target=_blank>穿梭虫洞</a></div><div class=footer-line><script>var build_date="2024-03-05T21:35:50+08:00"</script>已运行
<span id=run-time></span>
&nbsp;|&nbsp;
构建于
<span id=build-time></span>&nbsp;前</div><div class=footer-line><script async src=https://npm.elemecdn.com/penndu@1.0.0/bsz.js></script>
共计
<span id=busuanzi_value_site_uv></span>&nbsp;访客
&nbsp;|&nbsp;
<span id=busuanzi_value_site_pv></span>&nbsp;访问
&nbsp;|&nbsp;
256K&nbsp;字</div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i>
</a><a id=reader-button class=fixed-button title=阅读模式><i class="fa fa-book fa-fw"></i></a></div><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/gh/Albejr/jquery-albe-timeline/jquery-albe-timeline.min.js></script><script type=text/javascript src=https://fastly.jsdelivr.net/gh/caibingcheng/orlike@client/orlike.min.js></script><script type=text/javascript src=/js/custom.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"JMTHQS1VUU",algoliaIndex:"blog-bbing",algoliaSearchKey:"0dd43732743475449c844c0d0f21366a",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>